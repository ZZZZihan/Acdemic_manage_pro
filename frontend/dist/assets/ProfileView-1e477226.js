import{_ as M,u as N,y as m,C as y,z as k,D as T,c as z,b as A,d as l,w as a,E as p,r as u,G,o as H,H as x,e as U}from"./index-9a8ac2de.js";const I={class:"profile-view"},R={__name:"ProfileView",setup(j){const b=N(),f=m("info"),w=m(!1),i=m(!1),_=m(null),c=m(null),r=y({username:"",email:"",name:"",location:"",about_me:""}),n=y({oldPassword:"",newPassword:"",confirmPassword:""}),D={name:[{max:64,message:"姓名长度不能超过64个字符",trigger:"blur"}],location:[{max:64,message:"所在地长度不能超过64个字符",trigger:"blur"}]},E={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(s,e,t)=>{e===""?t(new Error("请再次输入密码")):e!==n.newPassword?t(new Error("两次输入密码不一致")):t()},trigger:"blur"}]},v=async()=>{w.value=!0;try{await b.fetchUserProfile();const s=b.user;s&&(r.username=s.username||"",r.email=s.email||"",r.name=s.name||"",r.location=s.location||"",r.about_me=s.about_me||"")}catch(s){console.error("获取用户信息失败:",s),p.error("获取用户信息失败")}finally{w.value=!1}},F=async()=>{_.value&&await _.value.validate(async s=>{if(s){i.value=!0;try{p.success("个人信息更新成功"),await v()}catch(e){console.error("更新个人信息失败:",e),p.error("更新个人信息失败")}finally{i.value=!1}}})},S=async()=>{c.value&&await c.value.validate(async s=>{if(s){i.value=!0;try{p.success("密码修改成功"),n.oldPassword="",n.newPassword="",n.confirmPassword="",f.value="info"}catch(e){console.error("修改密码失败:",e),p.error("修改密码失败")}finally{i.value=!1}}})};return k(()=>{v()}),(s,e)=>{const t=u("el-input"),d=u("el-form-item"),V=u("el-button"),g=u("el-form"),P=u("el-tab-pane"),q=u("el-tabs"),B=u("el-card"),C=G("loading");return T((H(),z("div",I,[e[11]||(e[11]=A("h2",{class:"page-title"},"个人中心",-1)),l(B,{class:"profile-card"},{default:a(()=>[l(q,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=o=>f.value=o)},{default:a(()=>[l(P,{label:"个人信息",name:"info"},{default:a(()=>[l(g,{ref_key:"profileForm",ref:_,model:r,rules:D,"label-width":"100px",onSubmit:x(F,["prevent"])},{default:a(()=>[l(d,{label:"用户名",prop:"username"},{default:a(()=>[l(t,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=o=>r.username=o),disabled:""},null,8,["modelValue"])]),_:1}),l(d,{label:"邮箱",prop:"email"},{default:a(()=>[l(t,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=o=>r.email=o),disabled:""},null,8,["modelValue"])]),_:1}),l(d,{label:"姓名",prop:"name"},{default:a(()=>[l(t,{modelValue:r.name,"onUpdate:modelValue":e[2]||(e[2]=o=>r.name=o)},null,8,["modelValue"])]),_:1}),l(d,{label:"所在地",prop:"location"},{default:a(()=>[l(t,{modelValue:r.location,"onUpdate:modelValue":e[3]||(e[3]=o=>r.location=o)},null,8,["modelValue"])]),_:1}),l(d,{label:"个人简介",prop:"about_me"},{default:a(()=>[l(t,{modelValue:r.about_me,"onUpdate:modelValue":e[4]||(e[4]=o=>r.about_me=o),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(V,{type:"primary","native-type":"submit",loading:i.value},{default:a(()=>e[9]||(e[9]=[U(" 保存修改 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),l(P,{label:"修改密码",name:"password"},{default:a(()=>[l(g,{ref_key:"passwordForm",ref:c,model:n,rules:E,"label-width":"100px",onSubmit:x(S,["prevent"])},{default:a(()=>[l(d,{label:"当前密码",prop:"oldPassword"},{default:a(()=>[l(t,{modelValue:n.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>n.oldPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(d,{label:"新密码",prop:"newPassword"},{default:a(()=>[l(t,{modelValue:n.newPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>n.newPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(d,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[l(t,{modelValue:n.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=o=>n.confirmPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(V,{type:"primary","native-type":"submit",loading:i.value},{default:a(()=>e[10]||(e[10]=[U(" 修改密码 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])),[[C,w.value]])}}},L=M(R,[["__scopeId","data-v-6fcdd619"]]);export{L as default};
