import{_ as k,u as L,y as f,C as I,c as x,b as p,d as o,w as a,H as S,e as c,a as h,i as q,r as u,o as B,E as w}from"./index-9a8ac2de.js";const C={class:"login-view"},E={class:"form-footer"},N={__name:"LoginView",setup(F){h();const v=q(),t=L(),d=f(null),g=f(!1),s=I({email:"",password:""}),b={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}]},y=async()=>{d.value&&await d.value.validate(async _=>{var e,n,r;if(_){g.value=!0;try{console.log("开始登录请求，数据:",s);const l=await t.login(s);console.log("登录成功，响应数据:",l),w.success("登录成功"),console.log("登录后状态检查:",{isLoggedIn:t.isLoggedIn,token:!!t.token,user:t.user});const i=v.query.redirect||"/";console.log("准备跳转到:",i),setTimeout(()=>{console.log("执行路由跳转前再次检查登录状态:",{isLoggedIn:t.isLoggedIn,token:!!t.token,user:t.user,localStorage:{token:localStorage.getItem("token"),user:localStorage.getItem("user")}}),console.log("执行路由跳转到:",i),window.location.href=i},1e3)}catch(l){console.error("登录失败:",l),console.error("错误详情:",(e=l.response)==null?void 0:e.data),w.error(((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)||"登录失败，请检查您的凭证")}finally{g.value=!1}}})};return(_,e)=>{const n=u("el-input"),r=u("el-form-item"),l=u("el-button"),i=u("el-form"),V=u("router-link");return B(),x("div",C,[e[5]||(e[5]=p("h2",{class:"page-title"},"用户登录",-1)),o(i,{ref_key:"loginForm",ref:d,model:s,rules:b,"label-position":"top",onSubmit:S(y,["prevent"])},{default:a(()=>[o(r,{label:"邮箱",prop:"email"},{default:a(()=>[o(n,{modelValue:s.email,"onUpdate:modelValue":e[0]||(e[0]=m=>s.email=m),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),o(r,{label:"密码",prop:"password"},{default:a(()=>[o(n,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=m=>s.password=m),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),o(r,null,{default:a(()=>[o(l,{type:"primary","native-type":"submit",loading:g.value,class:"submit-btn"},{default:a(()=>e[2]||(e[2]=[c(" 登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),p("div",E,[p("p",null,[e[4]||(e[4]=c("还没有账号？")),o(V,{to:"/auth/register"},{default:a(()=>e[3]||(e[3]=[c("立即注册")])),_:1})])])])}}},R=k(N,[["__scopeId","data-v-d6ec02e3"]]);export{R as default};
