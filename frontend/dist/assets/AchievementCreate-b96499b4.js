import{_ as k,y as g,C as q,c as B,b,d as t,w as o,a as D,r as u,o as E,e as h,H as M,B as R,E as V}from"./index-9a8ac2de.js";import{F as Y}from"./FileUpload-c7558ec6.js";const A={class:"achievement-create"},N={class:"page-header"},$={__name:"AchievementCreate",setup(z){const y=D(),m=g(null),f=g(null),c=g(!1),e=q({title:"",achievement_type:"",authors:"",publish_date:"",description:"",url:"",files:[]}),U={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],achievement_type:[{required:!0,message:"请选择成果类型",trigger:"change"}],authors:[{required:!0,message:"请输入作者",trigger:"blur"}],publish_date:[{required:!0,message:"请选择发布日期",trigger:"change"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}],url:[{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/,message:"请输入有效的URL",trigger:"blur"}]},w=_=>{e.files.push(_)},F=async()=>{m.value&&await m.value.validate(async _=>{var l,p,d,r,i;if(_){c.value=!0;try{const a={title:e.title,achievement_type:e.achievement_type,authors:e.authors,publish_date:e.publish_date,description:e.description,url:e.url};e.files.length>0&&(a.file_path=e.files[0].file_path,a.original_file_name=e.files[0].original_name,e.files.length>1&&(a.additional_files=e.files.slice(1))),console.log("提交数据:",a),Object.keys(a).forEach(n=>{n!=="additional_files"&&a[n]!==null&&a[n]!==void 0&&typeof a[n]!="string"&&(a[n]=String(a[n]))}),console.log("处理后的提交数据:",a);const v=await R.post("/api/v1/achievements",a);console.log("成功响应:",v.data),V.success("成果添加成功"),y.push("/achievements")}catch(a){console.error("添加成果失败:",a),console.error("错误详情:",(l=a.response)==null?void 0:l.data),V.error(((d=(p=a.response)==null?void 0:p.data)==null?void 0:d.message)||((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.msg)||"添加成果失败")}finally{c.value=!1}}})},x=()=>{m.value&&(m.value.resetFields(),f.value&&f.value.clearFiles(),e.files=[])};return(_,l)=>{const p=u("el-button"),d=u("el-input"),r=u("el-form-item"),i=u("el-option"),a=u("el-select"),v=u("el-date-picker"),n=u("el-form"),C=u("el-card");return E(),B("div",A,[b("div",N,[l[8]||(l[8]=b("h2",{class:"page-title"},"添加成果",-1)),t(p,{onClick:l[0]||(l[0]=s=>_.$router.back())},{default:o(()=>l[7]||(l[7]=[h("返回")])),_:1})]),t(C,null,{default:o(()=>[t(n,{ref_key:"achievementForm",ref:m,model:e,rules:U,"label-width":"100px",onSubmit:M(F,["prevent"])},{default:o(()=>[t(r,{label:"标题",prop:"title"},{default:o(()=>[t(d,{modelValue:e.title,"onUpdate:modelValue":l[1]||(l[1]=s=>e.title=s),placeholder:"请输入成果标题"},null,8,["modelValue"])]),_:1}),t(r,{label:"类型",prop:"achievement_type"},{default:o(()=>[t(a,{modelValue:e.achievement_type,"onUpdate:modelValue":l[2]||(l[2]=s=>e.achievement_type=s),placeholder:"请选择成果类型",style:{width:"100%"}},{default:o(()=>[t(i,{label:"论文",value:"论文"}),t(i,{label:"专利",value:"专利"}),t(i,{label:"项目",value:"项目"}),t(i,{label:"奖项",value:"奖项"}),t(i,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"作者",prop:"authors"},{default:o(()=>[t(d,{modelValue:e.authors,"onUpdate:modelValue":l[3]||(l[3]=s=>e.authors=s),placeholder:"请输入作者，多个作者用逗号分隔"},null,8,["modelValue"])]),_:1}),t(r,{label:"发布日期",prop:"publish_date"},{default:o(()=>[t(v,{modelValue:e.publish_date,"onUpdate:modelValue":l[4]||(l[4]=s=>e.publish_date=s),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(r,{label:"描述",prop:"description"},{default:o(()=>[t(d,{modelValue:e.description,"onUpdate:modelValue":l[5]||(l[5]=s=>e.description=s),type:"textarea",rows:5,placeholder:"请输入成果描述"},null,8,["modelValue"])]),_:1}),t(r,{label:"相关链接",prop:"url"},{default:o(()=>[t(d,{modelValue:e.url,"onUpdate:modelValue":l[6]||(l[6]=s=>e.url=s),placeholder:"请输入相关链接（可选）"},null,8,["modelValue"])]),_:1}),t(r,{label:"附件",prop:"files"},{default:o(()=>[t(Y,{ref_key:"fileUploadRef",ref:f,onFileUploaded:w},null,512)]),_:1}),t(r,null,{default:o(()=>[t(p,{type:"primary","native-type":"submit",loading:c.value},{default:o(()=>l[9]||(l[9]=[h("提交")])),_:1},8,["loading"]),t(p,{onClick:x},{default:o(()=>l[10]||(l[10]=[h("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},H=k($,[["__scopeId","data-v-0af1da29"]]);export{H as default};
