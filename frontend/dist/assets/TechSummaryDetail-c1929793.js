import{_ as N,y as h,C as F,K as q,z as U,r as c,o as r,c as d,b as t,F as K,A as L,L as O,g as C,t as _,x as b,d as n,I as G,w as u,e as v,M as B,B as R,E as V,D as H,f as M,i as J,a as j,G as P}from"./index-9a8ac2de.js";import{M as A}from"./MarkdownRenderer-1712c157.js";const Q={class:"document-chat"},W={class:"chat-container"},X={class:"message-content"},Y={key:1},Z={class:"message-time"},ee={key:0,class:"message ai-message"},te={class:"chat-input"},se={class:"chat-settings"},ae={class:"settings-group"},oe={__name:"DocumentChat",props:{documentId:{type:[Number,String],required:!0}},setup(z){const I=z,f=h(null),i=h(""),e=h(!1),y=h("deepseek"),k=h(!0),g=F([{role:"ai",content:"您好！我是您的文档助手，您可以向我提问关于这篇技术总结的任何问题。",time:new Date}]),w=async()=>{const m=i.value.trim();if(!(!m||e.value)){g.push({role:"user",content:m,time:new Date}),i.value="",await B(),p(),e.value=!0;try{const s=await R.post(`/api/v1/tech_summaries/${I.documentId}/chat`,{query:m,provider:y.value,useKnowledgeBase:k.value});s.data.success?g.push({role:"ai",content:s.data.data.answer,time:new Date,provider:s.data.data.provider}):V.error(s.data.message||"获取回答失败")}catch(s){console.error("聊天请求失败:",s),V.error("请求失败，请稍后再试")}finally{e.value=!1,await B(),p()}}},o=()=>{g.splice(1)},a=m=>new Date(m).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),p=()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)};return q(g,()=>{B(()=>{p()})}),U(()=>{p()}),(m,s)=>{const x=c("el-input"),D=c("el-button"),$=c("el-option"),S=c("el-select"),T=c("el-switch");return r(),d("div",Q,[t("div",W,[t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:f},[(r(!0),d(K,null,L(g,(l,E)=>(r(),d("div",{key:E,class:O(["message",l.role==="user"?"user-message":"ai-message"])},[t("div",X,[l.role==="ai"?(r(),C(A,{key:0,content:l.content},null,8,["content"])):(r(),d("div",Y,_(l.content),1))]),t("div",Z,_(a(l.time)),1)],2))),128)),e.value?(r(),d("div",ee,s[3]||(s[3]=[t("div",{class:"message-content"},[t("div",{class:"typing-indicator"},[t("span"),t("span"),t("span")])],-1)]))):b("",!0)],512),t("div",te,[n(x,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=l=>i.value=l),type:"textarea",rows:2,placeholder:"输入您的问题...",onKeyup:G(w,["enter","native"]),disabled:e.value},null,8,["modelValue","disabled"]),n(D,{type:"primary",onClick:w,disabled:e.value||!i.value.trim(),loading:e.value},{default:u(()=>s[4]||(s[4]=[v(" 发送 ")])),_:1},8,["disabled","loading"])])]),t("div",se,[t("div",ae,[n(S,{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=l=>y.value=l),placeholder:"选择AI模型",size:"small"},{default:u(()=>[n($,{label:"DeepSeek",value:"deepseek"}),n($,{label:"OpenAI",value:"openai"})]),_:1},8,["modelValue"]),n(T,{modelValue:k.value,"onUpdate:modelValue":s[2]||(s[2]=l=>k.value=l),"active-text":"使用知识库","inactive-text":"仅当前文档",size:"small"},null,8,["modelValue"])]),n(D,{size:"small",type:"danger",onClick:o},{default:u(()=>s[5]||(s[5]=[v("清空对话")])),_:1})])])}}},le=N(oe,[["__scopeId","data-v-b6610859"]]);const ne={class:"tech-summary-detail"},re={class:"page-header"},ie={class:"header-actions"},ue={class:"summary-header"},ce={class:"summary-title"},de={class:"summary-meta"},me={class:"meta-item"},_e={class:"meta-item"},pe={key:0,class:"summary-tags"},ve={key:1,class:"source-url"},ye=["href"],ge={class:"summary-content"},he={key:0,class:"summary-attachment"},fe={__name:"TechSummaryDetail",setup(z){const I=J(),f=j(),i=I.params.id,e=h(null),y=h(!1),k=async()=>{y.value=!0;try{console.log("获取技术总结详情ID:",i),console.log("请求URL:",`/api/v1/tech_summaries/${i}`);const o=await R.get(`/api/v1/tech_summaries/${i}`);console.log("技术总结详情响应状态:",o.status),console.log("技术总结详情响应数据:",JSON.stringify(o.data,null,2)),e.value=o.data,console.log("处理后的summary:",e.value)}catch(o){console.error("获取技术总结详情失败:",o),console.error("错误详情:",o.response?o.response.data:o.message),V.error("获取技术总结详情失败")}finally{y.value=!1}},g=()=>{if(!e.value||!e.value.file_path)return;const o=`http://localhost:5003/api/v1/files/download/${encodeURIComponent(e.value.file_path)}`;window.open(o,"_blank")},w=o=>o?new Date(o).toLocaleString():"-";return U(()=>{console.log("技术总结详情页面已挂载，ID:",i),i?k():(console.error("未找到技术总结ID"),V.error("未找到技术总结"),f.push("/tech_summaries"))}),(o,a)=>{const p=c("el-button"),m=c("el-tag"),s=c("el-divider"),x=c("el-collapse-item"),D=c("el-collapse"),$=c("el-card"),S=c("el-empty"),T=P("loading");return H((r(),d("div",ne,[t("div",re,[a[4]||(a[4]=t("h2",{class:"page-title"},"技术总结详情",-1)),t("div",ie,[n(p,{onClick:a[0]||(a[0]=l=>o.$router.push("/tech_summaries"))},{default:u(()=>a[2]||(a[2]=[v("返回列表")])),_:1}),n(p,{type:"primary",onClick:a[1]||(a[1]=l=>o.$router.push(`/tech_summaries/${M(i)}/edit`))},{default:u(()=>a[3]||(a[3]=[v("编辑")])),_:1})])]),e.value?(r(),C($,{key:0},{default:u(()=>[t("div",ue,[t("h1",ce,_(e.value.title),1),t("div",de,[n(m,null,{default:u(()=>[v(_(e.value.summary_type),1)]),_:1}),t("span",me,"创建时间: "+_(w(e.value.created_at)),1),t("span",_e,"更新时间: "+_(w(e.value.updated_at)),1)]),e.value.tags?(r(),d("div",pe,[(r(!0),d(K,null,L(e.value.tags.split(","),l=>(r(),C(m,{key:l,size:"small",class:"tag-item"},{default:u(()=>[v(_(l.trim()),1)]),_:2},1024))),128))])):b("",!0),e.value.source_url?(r(),d("div",ve,[a[5]||(a[5]=t("span",{class:"meta-item"},"来源: ",-1)),t("a",{href:e.value.source_url,target:"_blank",class:"source-link"},_(e.value.source_url),9,ye)])):b("",!0)]),t("div",ge,[n(A,{content:e.value.content},null,8,["content"])]),e.value.file_path?(r(),d("div",he,[a[6]||(a[6]=t("h3",null,"附件",-1)),n(p,{type:"primary",size:"small",onClick:g},{default:u(()=>[v(" 下载附件: "+_(e.value.original_file_name||"附件"),1)]),_:1})])):b("",!0),n(s,{"content-position":"center"},{default:u(()=>a[7]||(a[7]=[v("与文档对话")])),_:1}),n(D,null,{default:u(()=>[n(x,{title:"打开聊天",name:"1"},{default:u(()=>[n(le,{"document-id":M(i)},null,8,["document-id"])]),_:1})]),_:1})]),_:1})):(r(),C(S,{key:1,description:"未找到技术总结"}))])),[[T,y.value]])}}},De=N(fe,[["__scopeId","data-v-019e6468"]]);export{De as default};
