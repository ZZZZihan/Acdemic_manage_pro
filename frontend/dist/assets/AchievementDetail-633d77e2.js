import{_ as V,u as L,y as b,j as M,z as R,D as z,c as I,b as _,d as n,w as l,g as d,x as v,i as U,a as j,B as k,E as f,J as F,r as m,G,o as c,e as s,t as r}from"./index-9a8ac2de.js";const J={class:"achievement-detail"},P={class:"page-header"},W={class:"header-actions"},q={class:"description-content"},H=["href"],K={__name:"AchievementDetail",setup(O){const D=U(),h=j(),p=L(),e=b(null),u=b(!1),y=M(()=>!e.value||!p.user?!1:p.isAdmin||e.value.user_id===p.user.id),$=async()=>{u.value=!0;try{const t=await k.get(`/api/v1/achievements/${D.params.id}`);e.value=t.data}catch(t){console.error("获取成果详情失败:",t),f.error("获取成果详情失败")}finally{u.value=!1}},w=()=>{h.push(`/achievements/${e.value.id}/edit`)},C=()=>{F.confirm("确定要删除这个成果吗？此操作不可逆。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{x()}).catch(()=>{})},x=async()=>{u.value=!0;try{await k.delete(`/api/v1/achievements/${e.value.id}`),f.success("成果已成功删除"),h.push("/achievements")}catch(t){console.error("删除成果失败:",t),f.error("删除成果失败")}finally{u.value=!1}},A=()=>{if(!e.value||!e.value.file_path)return;const t=`http://localhost:5003/api/v1/files/download/${e.value.file_path}`,a=e.value.original_file_name?`${t}?original_name=${encodeURIComponent(e.value.original_file_name)}`:t,o=document.createElement("a");o.href=a,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)},B=t=>t?new Date(t).toLocaleDateString():"-",g=t=>{if(!t)return"-";const a=new Date(t);return`${a.toLocaleDateString()} ${a.toLocaleTimeString()}`};return R(()=>{$()}),(t,a)=>{const o=m("el-button"),i=m("el-descriptions-item"),E=m("el-descriptions"),N=m("el-card"),S=m("el-empty"),T=G("loading");return z((c(),I("div",J,[_("div",P,[a[4]||(a[4]=_("h2",{class:"page-title"},"成果详情",-1)),_("div",W,[n(o,{onClick:a[0]||(a[0]=Q=>t.$router.back())},{default:l(()=>a[1]||(a[1]=[s("返回")])),_:1}),y.value?(c(),d(o,{key:0,type:"primary",onClick:w},{default:l(()=>a[2]||(a[2]=[s("编辑")])),_:1})):v("",!0),y.value?(c(),d(o,{key:1,type:"danger",onClick:C},{default:l(()=>a[3]||(a[3]=[s("删除")])),_:1})):v("",!0)])]),e.value?(c(),d(N,{key:0},{default:l(()=>[n(E,{column:1,border:""},{default:l(()=>[n(i,{label:"标题"},{default:l(()=>[s(r(e.value.title),1)]),_:1}),n(i,{label:"类型"},{default:l(()=>[s(r(e.value.achievement_type),1)]),_:1}),n(i,{label:"作者"},{default:l(()=>[s(r(e.value.authors),1)]),_:1}),n(i,{label:"发布日期"},{default:l(()=>[s(r(B(e.value.publish_date)),1)]),_:1}),n(i,{label:"描述"},{default:l(()=>[_("div",q,r(e.value.description||"暂无描述"),1)]),_:1}),e.value.url?(c(),d(i,{key:0,label:"相关链接"},{default:l(()=>[_("a",{href:e.value.url,target:"_blank"},r(e.value.url),9,H)]),_:1})):v("",!0),e.value.file_path?(c(),d(i,{key:1,label:"附件"},{default:l(()=>[n(o,{size:"small",type:"primary",onClick:A},{default:l(()=>[s(" 下载附件 "+r(e.value.original_file_name?`(${e.value.original_file_name})`:""),1)]),_:1})]),_:1})):v("",!0),n(i,{label:"创建时间"},{default:l(()=>[s(r(g(e.value.created_at)),1)]),_:1}),n(i,{label:"更新时间"},{default:l(()=>[s(r(g(e.value.updated_at)),1)]),_:1})]),_:1})]),_:1})):u.value?v("",!0):(c(),d(S,{key:1,description:"成果不存在或已被删除"}))])),[[T,u.value]])}}},Y=V(K,[["__scopeId","data-v-dae3ec5f"]]);export{Y as default};
