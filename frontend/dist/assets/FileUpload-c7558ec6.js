import{_ as S,u as U,y as B,j as d,K as E,z as M,r as u,o as j,c as A,d as _,w as r,b as C,t as m,e as I,E as s}from"./index-9a8ac2de.js";const L={class:"file-upload-container"},k={class:"el-upload__tip"},c=10,N={__name:"FileUpload",props:{initialFiles:{type:Array,default:()=>[]}},emits:["file-uploaded","file-removed"],setup(f,{expose:h,emit:v}){const l=f,n=v,x=U(),t=B([]),i=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","zip","rar","jpg","jpeg","png"],g=d(()=>"http://localhost:5003/api/v1/files/upload"),w=d(()=>({Authorization:`Bearer ${x.token}`}));E(()=>l.initialFiles,e=>{e&&e.length>0?t.value=e.map(o=>({name:o.original_name||"附件",url:`http://localhost:5003/api/v1/files/download/${encodeURIComponent(o.file_path)}`,raw:o})):t.value=[]},{immediate:!0}),M(()=>{l.initialFiles&&l.initialFiles.length>0&&(t.value=l.initialFiles.map(e=>({name:e.original_name||"附件",url:`http://localhost:5003/api/v1/files/download/${encodeURIComponent(e.file_path)}`,raw:e})))});const y=e=>{const o=e.name.split(".").pop().toLowerCase();return i.includes(o)?e.size/1024/1024<c?!0:(s.error(`文件大小不能超过 ${c}MB!`),!1):(s.error(`只允许上传 ${i.join(", ")} 格式的文件!`),!1)},z=(e,o,a)=>{console.log("文件上传成功:",e),n("file-uploaded",{original_name:o.name,file_path:e.file_path,file_size:o.size,file_type:o.type}),s.success("文件上传成功")},F=e=>{console.error("文件上传失败:",e),s.error("文件上传失败，请重试")},$=()=>{s.warning("已达到文件上传数量限制")},b=e=>{if(console.log("文件被移除:",e),e.raw)n("file-removed",e.raw);else{const o=t.value.findIndex(a=>a.uid===e.uid);o!==-1&&n("file-removed",t.value[o])}};return h({clearFiles:()=>{t.value=[]}}),(e,o)=>{const a=u("el-button"),p=u("el-upload");return j(),A("div",L,[_(p,{class:"file-uploader",action:g.value,headers:w.value,"on-success":z,"on-error":F,"on-exceed":$,"on-remove":b,"before-upload":y,"file-list":t.value,multiple:!0,name:"file","auto-upload":!0},{tip:r(()=>[C("div",k," 支持上传 "+m(i.join(", "))+" 格式文件，大小不超过 "+m(c)+"MB ",1)]),default:r(()=>[_(a,{type:"primary"},{default:r(()=>o[0]||(o[0]=[I("选择文件")])),_:1})]),_:1},8,["action","headers","file-list"])])}}},V=S(N,[["__scopeId","data-v-08a504fb"]]);export{V as F};
