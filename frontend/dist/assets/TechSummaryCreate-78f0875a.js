import{_ as N,y as v,C as D,c as $,b as c,d as l,w as a,D as q,g as C,a as j,r as m,G,o as A,e as _,x as J,t as Q,E as r,B as S,J as h}from"./index-9a8ac2de.js";import{F as W}from"./FileUpload-c7558ec6.js";import{M as z}from"./MarkdownEditor-ca3cd116.js";const H={class:"tech-summary-create"},K={class:"page-header"},X={class:"toggle-advanced"},Y={__name:"TechSummaryCreate",setup(Z){const T=j(),f=v(null),y=v(!1),b=v(!1),g=v(!1),t=D({title:"",summary_type:"",tags:"",content:"",file_path:"",original_file_name:"",source_url:""}),n=D({url:"",provider:"deepseek",customPrompt:""}),x={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],summary_type:[{required:!0,message:"请选择类型",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},V=async()=>{if(!n.url){r.warning("请输入要爬取的网页URL");return}b.value=!0;try{const i={url:n.url,provider:n.provider};n.customPrompt&&(i.custom_prompt=n.customPrompt),console.log("开始爬取和总结，请求数据:",i);const e=setTimeout(()=>{r.info("总结处理中，API调用可能需要较长时间，请耐心等待...")},5e3);try{const o=await S.post("/api/v1/tech_summaries/crawl",i,{timeout:12e4});if(clearTimeout(e),o.data.success){const s=o.data.data;console.log("爬取结果数据:",s),console.log("返回的标签:",s.tags),t.title=s.title||"技术总结",t.content=s.content,t.source_url=s.url,s.tags?(console.log("使用API返回的标签:",s.tags),t.tags=s.tags):(console.log("API未返回标签，使用自动推断"),P(s.content)),r.success("网页内容爬取和总结成功")}else r.error(o.data.message||"爬取失败")}catch(o){if(clearTimeout(e),console.error("爬取和总结失败:",o),o.code==="ECONNABORTED"||o.message&&o.message.includes("timeout"))r.error("API调用超时，服务响应时间过长"),n.provider==="deepseek"&&h.confirm("DeepSeek API响应超时，是否尝试使用OpenAI进行总结？","切换AI提供商",{confirmButtonText:"使用OpenAI",cancelButtonText:"取消",type:"warning"}).then(()=>{n.provider="openai",r.info("已切换到OpenAI，正在重新尝试..."),V()}).catch(()=>{r.info("已取消操作")});else if(o.response)if(console.error("错误响应状态:",o.response.status),console.error("错误响应数据:",o.response.data),o.response.status===400){const s=o.response.data.message||"请求参数错误";r.error(`爬取失败: ${s}`),n.provider==="deepseek"&&s.includes("DeepSeek API")&&h.confirm("DeepSeek API调用失败，是否尝试使用OpenAI进行总结？","切换AI提供商",{confirmButtonText:"使用OpenAI",cancelButtonText:"取消",type:"warning"}).then(()=>{n.provider="openai",r.info("已切换到OpenAI，正在重新尝试..."),V()}).catch(()=>{r.info("已取消操作")})}else o.response.status===401?r.error("未授权，请重新登录"):o.response.status===500?r.error("服务器内部错误，请稍后再试"):r.error(`请求失败，状态码: ${o.response.status}`);else r.error(`请求失败: ${o.message}`)}}catch(i){console.error("爬取过程中发生未知错误:",i),r.error("爬取过程中发生未知错误")}finally{b.value=!1}},P=i=>{const e=i.toLowerCase();e.includes("算法")||e.includes("algorithm")?t.summary_type="算法":e.includes("工具")||e.includes("tool")?t.summary_type="工具":e.includes("方法")||e.includes("method")?t.summary_type="方法":e.includes("经验")||e.includes("experience")?t.summary_type="经验":t.summary_type="其他";const o=[],s=["人工智能","AI","机器学习","ML","深度学习","DL","前端","Frontend","后端","Backend","全栈","Fullstack","数据库","Database","SQL","NoSQL","Python","Java","JavaScript","C++","Go","Rust","React","Vue","Angular","Node.js","Django","Flask","云计算","Cloud","容器","Container","Docker","Kubernetes","大数据","Big Data","数据分析","Data Analysis","网络安全","Security","加密","Encryption","OpenCV","计算机视觉","Computer Vision","图像处理","Image Processing","摄像头","Camera","USB设备","USB Device","VID","PID","动态库","DLL","设备驱动","Device Driver","API","RESTful","GraphQL","WebSocket","HTTP","微服务","Microservices","分布式系统","Distributed Systems","算法","Algorithm","数据结构","Data Structure","操作系统","OS","Linux","Windows","MacOS","嵌入式","Embedded","物联网","IoT"];for(const d of s)e.includes(d.toLowerCase())&&o.push(d);t.tags=o.slice(0,5).join(", ")},B=i=>{t.file_path=i.file_path,t.original_file_name=i.original_name},U=()=>{t.file_path="",t.original_file_name=""},F=async()=>{f.value&&await f.value.validate(async i=>{if(i){y.value=!0;try{const e=await S.post("/api/v1/tech_summaries",t);r.success("技术总结创建成功"),T.push(`/tech_summaries/${e.data.id}`)}catch(e){console.error("创建技术总结失败:",e),r.error("创建技术总结失败")}finally{y.value=!1}}else return r.warning("请完善表单信息"),!1})},L=()=>{f.value&&f.value.resetFields(),t.file_path="",t.original_file_name="",t.source_url=""};return(i,e)=>{const o=m("el-button"),s=m("el-input"),d=m("el-form-item"),p=m("el-option"),w=m("el-select"),k=m("el-form"),O=m("el-collapse-item"),R=m("el-collapse"),E=m("el-link"),I=m("el-card"),M=G("loading");return A(),$("div",H,[c("div",K,[e[11]||(e[11]=c("h2",{class:"page-title"},"添加技术总结",-1)),l(o,{onClick:e[0]||(e[0]=u=>i.$router.push("/tech_summaries"))},{default:a(()=>e[10]||(e[10]=[_("返回列表")])),_:1})]),l(I,{class:"mb-20"},{default:a(()=>[e[13]||(e[13]=c("div",{class:"card-title"},[c("h3",null,"网页内容爬取"),c("p",{class:"description"},"输入知识所在的网址，系统将自动爬取内容并使用AI进行总结")],-1)),l(k,{inline:!0,model:n,class:"crawl-form"},{default:a(()=>[l(d,{label:"网址",class:"url-input"},{default:a(()=>[l(s,{modelValue:n.url,"onUpdate:modelValue":e[1]||(e[1]=u=>n.url=u),placeholder:"请输入要爬取的网页URL",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"AI模型"},{default:a(()=>[l(w,{modelValue:n.provider,"onUpdate:modelValue":e[2]||(e[2]=u=>n.provider=u),placeholder:"选择AI模型"},{default:a(()=>[l(p,{label:"DeepSeek",value:"deepseek"}),l(p,{label:"OpenAI",value:"openai"})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(o,{type:"primary",onClick:V,loading:b.value},{default:a(()=>e[12]||(e[12]=[_(" 爬取并总结 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),g.value?(A(),C(R,{key:0},{default:a(()=>[l(O,{title:"高级选项",name:"1"},{default:a(()=>[l(k,{model:n,"label-width":"100px"},{default:a(()=>[l(d,{label:"自定义提示词"},{default:a(()=>[l(s,{modelValue:n.customPrompt,"onUpdate:modelValue":e[3]||(e[3]=u=>n.customPrompt=u),type:"textarea",rows:4,placeholder:"自定义提示词，用于指导AI如何总结内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})):J("",!0),c("div",X,[l(E,{type:"primary",onClick:e[4]||(e[4]=u=>g.value=!g.value)},{default:a(()=>[_(Q(g.value?"隐藏高级选项":"显示高级选项"),1)]),_:1})])]),_:1}),q((A(),C(I,null,{default:a(()=>[l(k,{ref_key:"formRef",ref:f,model:t,rules:x,"label-width":"100px",class:"summary-form"},{default:a(()=>[l(d,{label:"标题",prop:"title"},{default:a(()=>[l(s,{modelValue:t.title,"onUpdate:modelValue":e[5]||(e[5]=u=>t.title=u),placeholder:"请输入技术总结标题"},null,8,["modelValue"])]),_:1}),l(d,{label:"类型",prop:"summary_type"},{default:a(()=>[l(w,{modelValue:t.summary_type,"onUpdate:modelValue":e[6]||(e[6]=u=>t.summary_type=u),placeholder:"请选择类型",style:{width:"100%"}},{default:a(()=>[l(p,{label:"算法",value:"算法"}),l(p,{label:"工具",value:"工具"}),l(p,{label:"方法",value:"方法"}),l(p,{label:"经验",value:"经验"}),l(p,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"标签",prop:"tags"},{default:a(()=>[l(s,{modelValue:t.tags,"onUpdate:modelValue":e[7]||(e[7]=u=>t.tags=u),placeholder:"请输入标签，多个标签用逗号分隔"},null,8,["modelValue"])]),_:1}),l(d,{label:"内容",prop:"content"},{default:a(()=>[l(z,{modelValue:t.content,"onUpdate:modelValue":e[8]||(e[8]=u=>t.content=u),placeholder:"请输入技术总结内容，支持Markdown格式"},null,8,["modelValue"])]),_:1}),l(d,{label:"来源网址"},{default:a(()=>[l(s,{modelValue:t.source_url,"onUpdate:modelValue":e[9]||(e[9]=u=>t.source_url=u),placeholder:"内容来源的网址（可选）"},null,8,["modelValue"])]),_:1}),l(d,{label:"附件"},{default:a(()=>[l(W,{onFileUploaded:B,onFileRemoved:U})]),_:1}),l(d,null,{default:a(()=>[l(o,{type:"primary",onClick:F},{default:a(()=>e[14]||(e[14]=[_("提交")])),_:1}),l(o,{onClick:L},{default:a(()=>e[15]||(e[15]=[_("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})),[[M,y.value]])])}}},oe=N(Y,[["__scopeId","data-v-9a212774"]]);export{oe as default};
