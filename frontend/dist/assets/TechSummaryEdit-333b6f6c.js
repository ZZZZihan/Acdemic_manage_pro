import{_ as q,y,C as N,j,z,c as G,b as v,d as t,w as a,f as J,D as A,g as H,i as I,a as K,B as h,E as m,r as u,G as L,o as V,e as c,J as O}from"./index-9a8ac2de.js";import{F as P}from"./FileUpload-c7558ec6.js";import{M as Q}from"./MarkdownEditor-ca3cd116.js";const W={class:"tech-summary-edit"},X={class:"page-header"},Y={class:"header-actions"},Z={__name:"TechSummaryEdit",setup(ee){const w=I(),b=K(),d=w.params.id,f=y(null),n=y(!1),s=y(null),l=N({title:"",summary_type:"",tags:"",content:"",file_path:"",original_file_name:"",source_url:""}),k=j(()=>l.file_path&&l.original_file_name?[{file_path:l.file_path,original_name:l.original_file_name}]:[]),x={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],summary_type:[{required:!0,message:"请选择类型",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},F=async()=>{n.value=!0;try{const e=(await h.get(`/api/v1/tech_summaries/${d}`)).data;l.title=e.title,l.summary_type=e.summary_type,l.tags=e.tags,l.content=e.content,l.file_path=e.file_path,l.original_file_name=e.original_file_name,l.source_url=e.source_url,s.value={...e}}catch(o){console.error("获取技术总结详情失败:",o),m.error("获取技术总结详情失败")}finally{n.value=!1}},$=o=>{l.file_path=o.file_path,l.original_file_name=o.original_name},B=()=>{l.file_path="",l.original_file_name=""},C=async()=>{f.value&&await f.value.validate(async o=>{if(o){n.value=!0;try{await h.put(`/api/v1/tech_summaries/${d}`,l),m.success("技术总结更新成功"),b.push(`/tech_summaries/${d}`)}catch(e){console.error("更新技术总结失败:",e),m.error("更新技术总结失败")}finally{n.value=!1}}else return m.warning("请完善表单信息"),!1})},E=()=>{s.value&&(l.title=s.value.title,l.summary_type=s.value.summary_type,l.tags=s.value.tags,l.content=s.value.content,l.file_path=s.value.file_path,l.original_file_name=s.value.original_file_name,l.source_url=s.value.source_url)},U=()=>{O.confirm("确定要删除这个技术总结吗？此操作不可恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{D()}).catch(()=>{})},D=async()=>{n.value=!0;try{await h.delete(`/api/v1/tech_summaries/${d}`),m.success("技术总结已删除"),b.push("/tech_summaries")}catch(o){console.error("删除技术总结失败:",o),m.error("删除技术总结失败")}finally{n.value=!1}};return z(()=>{F()}),(o,e)=>{const _=u("el-button"),g=u("el-input"),i=u("el-form-item"),p=u("el-option"),M=u("el-select"),R=u("el-form"),T=u("el-card"),S=L("loading");return V(),G("div",W,[v("div",X,[e[9]||(e[9]=v("h2",{class:"page-title"},"编辑技术总结",-1)),v("div",Y,[t(_,{onClick:e[0]||(e[0]=r=>o.$router.push("/tech_summaries"))},{default:a(()=>e[7]||(e[7]=[c("返回列表")])),_:1}),t(_,{onClick:e[1]||(e[1]=r=>o.$router.push(`/tech_summaries/${J(d)}`))},{default:a(()=>e[8]||(e[8]=[c("查看详情")])),_:1})])]),A((V(),H(T,null,{default:a(()=>[t(R,{ref_key:"formRef",ref:f,model:l,rules:x,"label-width":"100px",class:"summary-form"},{default:a(()=>[t(i,{label:"标题",prop:"title"},{default:a(()=>[t(g,{modelValue:l.title,"onUpdate:modelValue":e[2]||(e[2]=r=>l.title=r),placeholder:"请输入技术总结标题"},null,8,["modelValue"])]),_:1}),t(i,{label:"类型",prop:"summary_type"},{default:a(()=>[t(M,{modelValue:l.summary_type,"onUpdate:modelValue":e[3]||(e[3]=r=>l.summary_type=r),placeholder:"请选择类型",style:{width:"100%"}},{default:a(()=>[t(p,{label:"算法",value:"算法"}),t(p,{label:"工具",value:"工具"}),t(p,{label:"方法",value:"方法"}),t(p,{label:"经验",value:"经验"}),t(p,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"标签",prop:"tags"},{default:a(()=>[t(g,{modelValue:l.tags,"onUpdate:modelValue":e[4]||(e[4]=r=>l.tags=r),placeholder:"请输入标签，多个标签用逗号分隔"},null,8,["modelValue"])]),_:1}),t(i,{label:"内容",prop:"content"},{default:a(()=>[t(Q,{modelValue:l.content,"onUpdate:modelValue":e[5]||(e[5]=r=>l.content=r),placeholder:"请输入技术总结内容，支持Markdown格式"},null,8,["modelValue"])]),_:1}),t(i,{label:"来源网址"},{default:a(()=>[t(g,{modelValue:l.source_url,"onUpdate:modelValue":e[6]||(e[6]=r=>l.source_url=r),placeholder:"内容来源的网址（可选）"},null,8,["modelValue"])]),_:1}),t(i,{label:"附件"},{default:a(()=>[t(P,{"initial-files":k.value,onFileUploaded:$,onFileRemoved:B},null,8,["initial-files"])]),_:1}),t(i,null,{default:a(()=>[t(_,{type:"primary",onClick:C},{default:a(()=>e[10]||(e[10]=[c("保存")])),_:1}),t(_,{onClick:E},{default:a(()=>e[11]||(e[11]=[c("重置")])),_:1}),t(_,{type:"danger",onClick:U},{default:a(()=>e[12]||(e[12]=[c("删除")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})),[[S,n.value]])])}}},oe=q(Z,[["__scopeId","data-v-058b6f4e"]]);export{oe as default};
