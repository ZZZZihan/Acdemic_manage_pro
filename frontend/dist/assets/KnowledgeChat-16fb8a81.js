import{_ as $,y as v,C as z,K as N,z as T,r as c,o as p,c as g,b as e,F as R,A,L as G,g as L,t as y,x as E,d as a,I as F,w as r,e as V,B as K,M as x,E as D,a as O}from"./index-9a8ac2de.js";import{M as j}from"./MarkdownRenderer-1712c157.js";const q={class:"global-knowledge-chat"},H={class:"chat-container"},P={class:"message-content"},J={key:1},Q={class:"message-time"},W={key:0,class:"message ai-message"},X={class:"chat-input"},Y={class:"chat-settings"},Z={class:"settings-group"},ee={__name:"GlobalKnowledgeChat",setup(B){const _=v(null),i=v(""),d=v(!1),h=v("deepseek"),l=v(!0),t=z([{role:"ai",content:"您好！我是您的知识库助手，您可以向我提问关于所有技术总结的任何问题。",time:new Date}]),k=async()=>{try{const o=await K.post("/api/v1/knowledge_base/init");o.data.success?console.log("知识库初始化成功:",o.data.message):console.error("知识库初始化失败:",o.data.message)}catch(o){console.error("知识库初始化请求失败:",o)}},m=async()=>{const o=i.value.trim();if(!(!o||d.value)){t.push({role:"user",content:o,time:new Date}),i.value="",await x(),w(),d.value=!0;try{const s=l.value?"/api/v1/rag/chat":"/api/v1/knowledge_base/chat",u=await K.post(s,{query:o,provider:h.value});u.data.success?t.push({role:"ai",content:u.data.data.answer,time:new Date,provider:l.value?u.data.data.model:u.data.data.provider,sources:u.data.data.sources||[]}):D.error(u.data.message||"获取回答失败")}catch(s){console.error("聊天请求失败:",s),D.error("请求失败，请稍后再试")}finally{d.value=!1,await x(),w()}}},f=()=>{t.splice(1)},b=o=>new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),w=()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)};return N(t,()=>{x(()=>{w()})}),T(()=>{w(),k()}),(o,s)=>{const u=c("el-input"),S=c("el-button"),C=c("el-option"),I=c("el-select"),M=c("el-switch");return p(),g("div",q,[s[6]||(s[6]=e("div",{class:"chat-header"},[e("h3",null,"知识库助手"),e("p",{class:"description"},"您可以向我提问关于所有技术总结的问题")],-1)),e("div",H,[e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:_},[(p(!0),g(R,null,A(t,(n,U)=>(p(),g("div",{key:U,class:G(["message",n.role==="user"?"user-message":"ai-message"])},[e("div",P,[n.role==="ai"?(p(),L(j,{key:0,content:n.content},null,8,["content"])):(p(),g("div",J,y(n.content),1))]),e("div",Q,y(b(n.time)),1)],2))),128)),d.value?(p(),g("div",W,s[3]||(s[3]=[e("div",{class:"message-content"},[e("div",{class:"typing-indicator"},[e("span"),e("span"),e("span")])],-1)]))):E("",!0)],512),e("div",X,[a(u,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=n=>i.value=n),type:"textarea",rows:2,placeholder:"输入您的问题...",onKeyup:F(m,["enter","native"]),disabled:d.value},null,8,["modelValue","disabled"]),a(S,{type:"primary",onClick:m,disabled:d.value||!i.value.trim(),loading:d.value},{default:r(()=>s[4]||(s[4]=[V(" 发送 ")])),_:1},8,["disabled","loading"])])]),e("div",Y,[e("div",Z,[a(I,{modelValue:h.value,"onUpdate:modelValue":s[1]||(s[1]=n=>h.value=n),placeholder:"选择AI模型",size:"small"},{default:r(()=>[a(C,{label:"DeepSeek",value:"deepseek"}),a(C,{label:"OpenAI",value:"openai"}),a(C,{label:"Ollama",value:"ollama"})]),_:1},8,["modelValue"]),a(M,{modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=n=>l.value=n),"active-text":"RAG","inactive-text":"普通",size:"small",style:{"margin-left":"10px"}},null,8,["modelValue"])]),a(S,{size:"small",type:"danger",onClick:f},{default:r(()=>s[5]||(s[5]=[V("清空对话")])),_:1})])])}}},te=$(ee,[["__scopeId","data-v-365fa1e5"]]);const se={class:"knowledge-chat-page"},ae={class:"page-header"},le={class:"header-actions"},oe={class:"stats-content"},ne={class:"stat-item"},ie={class:"stat-value"},re={class:"stat-item"},de={class:"stat-value"},ce={__name:"KnowledgeChat",setup(B){const _=O(),i=v({totalSummaries:0,lastUpdate:"-"}),d=()=>{console.log("跳转到技术总结页面");try{_.push("/tech_summaries")}catch(l){console.error("路由跳转错误:",l),window.location.href="/tech_summaries"}},h=async()=>{try{const l=await K.get("/api/v1/tech_summaries",{params:{per_page:1,page:1}});if(l.data&&(i.value.totalSummaries=l.data.total||0,l.data.items&&l.data.items.length>0)){const t=l.data.items[0];i.value.lastUpdate=new Date(t.updated_at).toLocaleDateString()}}catch(l){console.error("获取知识库统计信息失败:",l)}};return T(()=>{h()}),(l,t)=>{const k=c("el-button"),m=c("el-card"),f=c("el-col"),b=c("el-row");return p(),g("div",se,[e("div",ae,[t[1]||(t[1]=e("h2",{class:"page-title"},"知识库聊天",-1)),e("div",le,[a(k,{onClick:d},{default:r(()=>t[0]||(t[0]=[V("返回技术总结")])),_:1})])]),a(b,{gutter:20},{default:r(()=>[a(f,{span:16},{default:r(()=>[a(m,{class:"chat-card"},{default:r(()=>[a(te)]),_:1})]),_:1}),a(f,{span:8},{default:r(()=>[a(m,{class:"info-card"},{default:r(()=>t[2]||(t[2]=[e("h3",null,"知识库助手使用说明",-1),e("div",{class:"info-content"},[e("p",null,"知识库助手可以回答关于所有技术总结的问题，您可以："),e("ul",null,[e("li",null,"询问特定技术的用法和原理"),e("li",null,"查询某个概念的解释"),e("li",null,"寻找解决特定问题的方法"),e("li",null,"了解不同技术之间的比较")]),e("p",null,"示例问题："),e("ul",null,[e("li",null,'"React和Vue有什么区别？"'),e("li",null,'"如何解决Node.js内存泄漏问题？"'),e("li",null,'"Docker容器和虚拟机的优缺点是什么？"'),e("li",null,'"Python中如何处理异步操作？"')]),e("div",{class:"tips"},[e("h4",null,"提示："),e("p",null,"问题越具体，回答越准确。如果回答不满意，可以尝试重新表述问题或提供更多上下文。")])],-1)])),_:1}),a(m,{class:"stats-card"},{default:r(()=>[t[5]||(t[5]=e("h3",null,"知识库统计",-1)),e("div",oe,[e("div",ne,[t[3]||(t[3]=e("div",{class:"stat-label"},"技术总结数量",-1)),e("div",ie,y(i.value.totalSummaries),1)]),e("div",re,[t[4]||(t[4]=e("div",{class:"stat-label"},"最近更新",-1)),e("div",de,y(i.value.lastUpdate),1)])])]),_:1})]),_:1})]),_:1})])}}},_e=$(ce,[["__scopeId","data-v-d567015d"]]);export{_e as default};
